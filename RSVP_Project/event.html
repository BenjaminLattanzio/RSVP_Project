<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>jQuery UI Accordion - Default functionality</title>
  <link rel="stylesheet" href="./css/jquery-ui-1.12.1.custom/jquery-ui.min.css">
  <script src="./js/jquery-3.5.1.min.js"></script>
  <script src="./js/jquery-ui.min.js"></script>

</head>
<body>
  <div id="accordion">

  </div>
</body>
</html>


<script>
$(document).ready(function(){
  $.ajax({
    url:'eventInfo.php',
    type: 'get',
    dataType: 'JSON',
    data:{
    },
    success:function(response){
      var len = response.length;
      for(var i=0; i<len; i++){

        var eventID = response[i].eventID;
        var eventName = response[i].eventName;
        var eventDate = response[i].eventDate;
        var eventLocation = response[i].eventLocation;
        var eventCancel = response[i].eventCanceled;
        var eventStatus = response[i].eventStatus;
        var remainSpots = response[i].remainSpots;
        var rsvpDate = response[i].rsvpDate;
        var createdDate = response[i].createdDate;
        var currentDate = new Date();
        var newEventDate = new Date(eventDate.substring(0,4), parseInt(eventDate.substring(5,7))-1, eventDate.substring(8,10));
        var newCreatedDate = new Date(createdDate.substring(0,4), parseInt(createdDate.substring(5,7))-1, createdDate.substring(8,10));
        var weekAgo = currentDate.getDate() - 7;
        var spotVar = remainSpots;

        var html_str = "<h3>" + eventName + "</h3>" +
        "<div><p><b>"+
        "Event Date: " + eventDate +"</br>"+
        "Event Location: " + eventLocation +"</br>"+
        "Status: " + (newCreatedDate > weekAgo ? eventCancel=="No" ? "New" : "Cancelled" : "Active") +"</br>"+
        "Spots Remaining: " + remainSpots +"</br>"+
        "RSVP by: " + rsvpDate +"</br>"+
        "</b></p><p>";
        console.log("eventDate"+newEventDate);
        console.log("currentDate"+currentDate);
        console.log("remainSpots"+remainSpots);
        console.log("rsvpDate"+rsvpDate);
        console.log(newEventDate > currentDate);
        if( newEventDate > currentDate){
          if(eventCancel!="No"){
            if(userId == $_SESSION['uId']){
              html_str += "<form id= 'myForm' action='cancel.php' method='POST'>"+
              "<input type='hidden' name='event_id' value='" + eventID + "'  id='event_id' />"+
              "<input type='submit' id='cancelBtn' value='Cancel'>"+
              "</form>";
            }else if(spotVar>0) {
              html_str += "<form id= 'myForm' action='userInfo.php' method='POST'>"+
              "<input type='hidden' name='event_id' value='" + eventID + "'  id='event_id' />"+
              "<input type='submit' id='rsvpBtn' value='RSVP'>"+
              "</form>";
            } else{
              html_str += "Event is full";
            }
          }else{
            html_str += "Event is cancelled.";
          }
        }else{
          html_str += "Event has past.";
        }
        html_str += "</p></div>";

        $("#accordion").append(html_str);

      }
      $( "#accordion" ).accordion();
    }
  });


  $("#button").click(function(){
    var eType = caller.id;
    var fname=$("#fname").val();
    var lname=$("#lname").val();
    var email=$("#email").val();
    var phoneNum=$("#phoneNum").val();
    $.ajax({
      url:'userInfo.php',
      method:'POST',
      data:{
        fname:fname,
        lname:lname,
        email:email,
        phoneNum:phoneNum,
        eType:eType
      },
      success:function(data){
        alert(data);
        alert(data.eventID);
      }
    });
  });
});
</script>
